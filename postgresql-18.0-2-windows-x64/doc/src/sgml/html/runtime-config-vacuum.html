<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>19.10. Vacuuming</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="runtime-config-statistics.html" title="19.9. Run-time Statistics" /><link rel="next" href="runtime-config-client.html" title="19.11. Client Connection Defaults" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">19.10. Vacuuming</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="runtime-config-statistics.html" title="19.9. Run-time Statistics">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="runtime-config.html" title="Chapter 19. Server Configuration">Up</a></td><th width="60%" align="center">Chapter 19. Server Configuration</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 18.0 Documentation">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="runtime-config-client.html" title="19.11. Client Connection Defaults">Next</a></td></tr></table><hr /></div><div class="sect1" id="RUNTIME-CONFIG-VACUUM"><div class="titlepage"><div><div><h2 class="title" style="clear: both">19.10. Vacuuming <a href="#RUNTIME-CONFIG-VACUUM" class="id_link">#</a></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="runtime-config-vacuum.html#RUNTIME-CONFIG-AUTOVACUUM">19.10.1. Automatic Vacuuming</a></span></dt><dt><span class="sect2"><a href="runtime-config-vacuum.html#RUNTIME-CONFIG-RESOURCE-VACUUM-COST">19.10.2. Cost-based Vacuum Delay</a></span></dt><dt><span class="sect2"><a href="runtime-config-vacuum.html#RUNTIME-CONFIG-VACUUM-DEFAULT">19.10.3. Default Behavior</a></span></dt><dt><span class="sect2"><a href="runtime-config-vacuum.html#RUNTIME-CONFIG-VACUUM-FREEZING">19.10.4. Freezing</a></span></dt></dl></div><a id="id-1.6.6.13.2" class="indexterm"></a><p>
     These parameters control vacuuming behavior. For more information on the
     purpose and responsibilities of vacuum, see <a class="xref" href="routine-vacuuming.html" title="24.1. Routine Vacuuming">Section 24.1</a>.
    </p><div class="sect2" id="RUNTIME-CONFIG-AUTOVACUUM"><div class="titlepage"><div><div><h3 class="title">19.10.1. Automatic Vacuuming <a href="#RUNTIME-CONFIG-AUTOVACUUM" class="id_link">#</a></h3></div></div></div><p>
      These settings control the behavior of the <em class="firstterm">autovacuum</em>
      feature.  Refer to <a class="xref" href="routine-vacuuming.html#AUTOVACUUM" title="24.1.6. The Autovacuum Daemon">Section 24.1.6</a> for more information.
      Note that many of these settings can be overridden on a per-table
      basis; see <a class="xref" href="sql-createtable.html#SQL-CREATETABLE-STORAGE-PARAMETERS" title="Storage Parameters">Storage Parameters</a>.
     </p><div class="variablelist"><dl class="variablelist"><dt id="GUC-AUTOVACUUM"><span class="term"><code class="varname">autovacuum</code> (<code class="type">boolean</code>)
       <a id="id-1.6.6.13.4.3.1.1.3" class="indexterm"></a>
       </span> <a href="#GUC-AUTOVACUUM" class="id_link">#</a></dt><dd><p>
         Controls whether the server should run the
         autovacuum launcher daemon.  This is on by default; however,
         <a class="xref" href="runtime-config-statistics.html#GUC-TRACK-COUNTS">track_counts</a> must also be enabled for
         autovacuum to work.
         This parameter can only be set in the <code class="filename">postgresql.conf</code>
         file or on the server command line; however, autovacuuming can be
         disabled for individual tables by changing table storage parameters.
        </p><p>
         Note that even when this parameter is disabled, the system
         will launch autovacuum processes if necessary to
         prevent transaction ID wraparound.  See <a class="xref" href="routine-vacuuming.html#VACUUM-FOR-WRAPAROUND" title="24.1.5. Preventing Transaction ID Wraparound Failures">Section 24.1.5</a> for more information.
        </p></dd><dt id="GUC-AUTOVACUUM-WORKER-SLOTS"><span class="term"><code class="varname">autovacuum_worker_slots</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.4.3.2.1.3" class="indexterm"></a>
       </span> <a href="#GUC-AUTOVACUUM-WORKER-SLOTS" class="id_link">#</a></dt><dd><p>
         Specifies the number of backend slots to reserve for autovacuum worker
         processes.  The default is typically 16 slots, but might be less if
         your kernel settings will not support it (as determined during initdb).
         This parameter can only be set at server start.
        </p><p>
         When changing this value, consider also adjusting
         <a class="xref" href="runtime-config-vacuum.html#GUC-AUTOVACUUM-MAX-WORKERS">autovacuum_max_workers</a>.
        </p></dd><dt id="GUC-AUTOVACUUM-MAX-WORKERS"><span class="term"><code class="varname">autovacuum_max_workers</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.4.3.3.1.3" class="indexterm"></a>
       </span> <a href="#GUC-AUTOVACUUM-MAX-WORKERS" class="id_link">#</a></dt><dd><p>
         Specifies the maximum number of autovacuum processes (other than the
         autovacuum launcher) that may be running at any one time.  The default
         is <code class="literal">3</code>.  This parameter can only be set in the
         <code class="filename">postgresql.conf</code> file or on the server command line.
        </p><p>
         Note that a setting for this value which is higher than
         <a class="xref" href="runtime-config-vacuum.html#GUC-AUTOVACUUM-WORKER-SLOTS">autovacuum_worker_slots</a> will have no effect,
         since autovacuum workers are taken from the pool of slots established
         by that setting.
        </p></dd><dt id="GUC-AUTOVACUUM-NAPTIME"><span class="term"><code class="varname">autovacuum_naptime</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.4.3.4.1.3" class="indexterm"></a>
       </span> <a href="#GUC-AUTOVACUUM-NAPTIME" class="id_link">#</a></dt><dd><p>
         Specifies the minimum delay between autovacuum runs on any given
         database.  In each round the daemon examines the
         database and issues <code class="command">VACUUM</code> and <code class="command">ANALYZE</code> commands
         as needed for tables in that database.
         If this value is specified without units, it is taken as seconds.
         The default is one minute (<code class="literal">1min</code>).
         This parameter can only be set in the <code class="filename">postgresql.conf</code>
         file or on the server command line.
        </p></dd><dt id="GUC-AUTOVACUUM-VACUUM-THRESHOLD"><span class="term"><code class="varname">autovacuum_vacuum_threshold</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.4.3.5.1.3" class="indexterm"></a>
       </span> <a href="#GUC-AUTOVACUUM-VACUUM-THRESHOLD" class="id_link">#</a></dt><dd><p>
         Specifies the minimum number of updated or deleted tuples needed
         to trigger a <code class="command">VACUUM</code> in any one table.
         The default is 50 tuples.
         This parameter can only be set in the <code class="filename">postgresql.conf</code>
         file or on the server command line;
         but the setting can be overridden for individual tables by
         changing table storage parameters.
        </p></dd><dt id="GUC-AUTOVACUUM-VACUUM-INSERT-THRESHOLD"><span class="term"><code class="varname">autovacuum_vacuum_insert_threshold</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.4.3.6.1.3" class="indexterm"></a>
       </span> <a href="#GUC-AUTOVACUUM-VACUUM-INSERT-THRESHOLD" class="id_link">#</a></dt><dd><p>
         Specifies the number of inserted tuples needed to trigger a
         <code class="command">VACUUM</code> in any one table.
         The default is 1000 tuples.  If -1 is specified, autovacuum will not
         trigger a <code class="command">VACUUM</code> operation on any tables based on
         the number of inserts.
         This parameter can only be set in the <code class="filename">postgresql.conf</code>
         file or on the server command line;
         but the setting can be overridden for individual tables by
         changing table storage parameters.
        </p></dd><dt id="GUC-AUTOVACUUM-ANALYZE-THRESHOLD"><span class="term"><code class="varname">autovacuum_analyze_threshold</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.4.3.7.1.3" class="indexterm"></a>
       </span> <a href="#GUC-AUTOVACUUM-ANALYZE-THRESHOLD" class="id_link">#</a></dt><dd><p>
         Specifies the minimum number of inserted, updated or deleted tuples
         needed to trigger an <code class="command">ANALYZE</code> in any one table.
         The default is 50 tuples.
         This parameter can only be set in the <code class="filename">postgresql.conf</code>
         file or on the server command line;
         but the setting can be overridden for individual tables by
         changing table storage parameters.
        </p></dd><dt id="GUC-AUTOVACUUM-VACUUM-SCALE-FACTOR"><span class="term"><code class="varname">autovacuum_vacuum_scale_factor</code> (<code class="type">floating point</code>)
       <a id="id-1.6.6.13.4.3.8.1.3" class="indexterm"></a>
       </span> <a href="#GUC-AUTOVACUUM-VACUUM-SCALE-FACTOR" class="id_link">#</a></dt><dd><p>
         Specifies a fraction of the table size to add to
         <code class="varname">autovacuum_vacuum_threshold</code>
         when deciding whether to trigger a <code class="command">VACUUM</code>.
         The default is <code class="literal">0.2</code> (20% of table size).
         This parameter can only be set in the <code class="filename">postgresql.conf</code>
         file or on the server command line;
         but the setting can be overridden for individual tables by
         changing table storage parameters.
        </p></dd><dt id="GUC-AUTOVACUUM-VACUUM-INSERT-SCALE-FACTOR"><span class="term"><code class="varname">autovacuum_vacuum_insert_scale_factor</code> (<code class="type">floating point</code>)
       <a id="id-1.6.6.13.4.3.9.1.3" class="indexterm"></a>
       </span> <a href="#GUC-AUTOVACUUM-VACUUM-INSERT-SCALE-FACTOR" class="id_link">#</a></dt><dd><p>
         Specifies a fraction of the unfrozen pages in the table to add to
         <code class="varname">autovacuum_vacuum_insert_threshold</code> when deciding
         whether to trigger a <code class="command">VACUUM</code>. The default is
         <code class="literal">0.2</code> (20% of unfrozen pages in table). This
         parameter can only be set in the <code class="filename">postgresql.conf</code>
         file or on the server command line; but the setting can be overridden
         for individual tables by changing table storage parameters.
        </p></dd><dt id="GUC-AUTOVACUUM-ANALYZE-SCALE-FACTOR"><span class="term"><code class="varname">autovacuum_analyze_scale_factor</code> (<code class="type">floating point</code>)
       <a id="id-1.6.6.13.4.3.10.1.3" class="indexterm"></a>
       </span> <a href="#GUC-AUTOVACUUM-ANALYZE-SCALE-FACTOR" class="id_link">#</a></dt><dd><p>
         Specifies a fraction of the table size to add to
         <code class="varname">autovacuum_analyze_threshold</code>
         when deciding whether to trigger an <code class="command">ANALYZE</code>.
         The default is <code class="literal">0.1</code> (10% of table size).
         This parameter can only be set in the <code class="filename">postgresql.conf</code>
         file or on the server command line;
         but the setting can be overridden for individual tables by
         changing table storage parameters.
        </p></dd><dt id="GUC-AUTOVACUUM-VACUUM-MAX-THRESHOLD"><span class="term"><code class="varname">autovacuum_vacuum_max_threshold</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.4.3.11.1.3" class="indexterm"></a>
       </span> <a href="#GUC-AUTOVACUUM-VACUUM-MAX-THRESHOLD" class="id_link">#</a></dt><dd><p>
         Specifies the maximum number of updated or deleted tuples needed to
         trigger a <code class="command">VACUUM</code> in any one table, i.e., a limit on
         the value calculated with
         <code class="varname">autovacuum_vacuum_threshold</code> and
         <code class="varname">autovacuum_vacuum_scale_factor</code>.  The default is
         100,000,000 tuples.  If -1 is specified, autovacuum will not enforce a
         maximum number of updated or deleted tuples that will trigger a
         <code class="command">VACUUM</code> operation.  This parameter can only be set
         in the <code class="filename">postgresql.conf</code> file or on the server
         command line; but the setting can be overridden for individual tables
         by changing storage parameters.
        </p></dd><dt id="GUC-AUTOVACUUM-FREEZE-MAX-AGE"><span class="term"><code class="varname">autovacuum_freeze_max_age</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.4.3.12.1.3" class="indexterm"></a>
       </span> <a href="#GUC-AUTOVACUUM-FREEZE-MAX-AGE" class="id_link">#</a></dt><dd><p>
         Specifies the maximum age (in transactions) that a table's
         <code class="structname">pg_class</code>.<code class="structfield">relfrozenxid</code> field can
         attain before a <code class="command">VACUUM</code> operation is forced
         to prevent transaction ID wraparound within the table.
         Note that the system will launch autovacuum processes to
         prevent wraparound even when autovacuum is otherwise disabled.
        </p><p>
         Vacuum also allows removal of old files from the
         <code class="filename">pg_xact</code> subdirectory, which is why the default
         is a relatively low 200 million transactions.
         This parameter can only be set at server start, but the setting
         can be reduced for individual tables by
         changing table storage parameters.
         For more information see <a class="xref" href="routine-vacuuming.html#VACUUM-FOR-WRAPAROUND" title="24.1.5. Preventing Transaction ID Wraparound Failures">Section 24.1.5</a>.
        </p></dd><dt id="GUC-AUTOVACUUM-MULTIXACT-FREEZE-MAX-AGE"><span class="term"><code class="varname">autovacuum_multixact_freeze_max_age</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.4.3.13.1.3" class="indexterm"></a>
       </span> <a href="#GUC-AUTOVACUUM-MULTIXACT-FREEZE-MAX-AGE" class="id_link">#</a></dt><dd><p>
         Specifies the maximum age (in multixacts) that a table's
         <code class="structname">pg_class</code>.<code class="structfield">relminmxid</code> field can
         attain before a <code class="command">VACUUM</code> operation is forced to
         prevent multixact ID wraparound within the table.
         Note that the system will launch autovacuum processes to
         prevent wraparound even when autovacuum is otherwise disabled.
        </p><p>
         Vacuuming multixacts also allows removal of old files from the
         <code class="filename">pg_multixact/members</code> and <code class="filename">pg_multixact/offsets</code>
         subdirectories, which is why the default is a relatively low
         400 million multixacts.
         This parameter can only be set at server start, but the setting can
         be reduced for individual tables by changing table storage parameters.
         For more information see <a class="xref" href="routine-vacuuming.html#VACUUM-FOR-MULTIXACT-WRAPAROUND" title="24.1.5.1. Multixacts and Wraparound">Section 24.1.5.1</a>.
        </p></dd><dt id="GUC-AUTOVACUUM-VACUUM-COST-DELAY"><span class="term"><code class="varname">autovacuum_vacuum_cost_delay</code> (<code class="type">floating point</code>)
       <a id="id-1.6.6.13.4.3.14.1.3" class="indexterm"></a>
       </span> <a href="#GUC-AUTOVACUUM-VACUUM-COST-DELAY" class="id_link">#</a></dt><dd><p>
         Specifies the cost delay value that will be used in automatic
         <code class="command">VACUUM</code> operations.  If -1 is specified, the regular
         <a class="xref" href="runtime-config-vacuum.html#GUC-VACUUM-COST-DELAY">vacuum_cost_delay</a> value will be used.
         If this value is specified without units, it is taken as milliseconds.
         The default value is 2 milliseconds.
         This parameter can only be set in the <code class="filename">postgresql.conf</code>
         file or on the server command line;
         but the setting can be overridden for individual tables by
         changing table storage parameters.
        </p></dd><dt id="GUC-AUTOVACUUM-VACUUM-COST-LIMIT"><span class="term"><code class="varname">autovacuum_vacuum_cost_limit</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.4.3.15.1.3" class="indexterm"></a>
       </span> <a href="#GUC-AUTOVACUUM-VACUUM-COST-LIMIT" class="id_link">#</a></dt><dd><p>
         Specifies the cost limit value that will be used in automatic
         <code class="command">VACUUM</code> operations.  If <code class="literal">-1</code>
         is specified (which is the default), the regular
         <a class="xref" href="runtime-config-vacuum.html#GUC-VACUUM-COST-LIMIT">vacuum_cost_limit</a> value will be used.  Note that
         the value is distributed proportionally among the running autovacuum
         workers, if there is more than one, so that the sum of the limits for
         each worker does not exceed the value of this variable.
         This parameter can only be set in the <code class="filename">postgresql.conf</code>
         file or on the server command line;
         but the setting can be overridden for individual tables by
         changing table storage parameters.
        </p></dd></dl></div></div><div class="sect2" id="RUNTIME-CONFIG-RESOURCE-VACUUM-COST"><div class="titlepage"><div><div><h3 class="title">19.10.2. Cost-based Vacuum Delay <a href="#RUNTIME-CONFIG-RESOURCE-VACUUM-COST" class="id_link">#</a></h3></div></div></div><p>
      During the execution of <a class="xref" href="sql-vacuum.html" title="VACUUM"><span class="refentrytitle">VACUUM</span></a>
      and <a class="xref" href="sql-analyze.html" title="ANALYZE"><span class="refentrytitle">ANALYZE</span></a>
      commands, the system maintains an
      internal counter that keeps track of the estimated cost of the
      various I/O operations that are performed.  When the accumulated
      cost reaches a limit (specified by
      <code class="varname">vacuum_cost_limit</code>), the process performing
      the operation will sleep for a short period of time, as specified by
      <code class="varname">vacuum_cost_delay</code>. Then it will reset the
      counter and continue execution.
     </p><p>
      The intent of this feature is to allow administrators to reduce
      the I/O impact of these commands on concurrent database
      activity. There are many situations where it is not
      important that maintenance commands like
      <code class="command">VACUUM</code> and <code class="command">ANALYZE</code> finish
      quickly; however, it is usually very important that these
      commands do not significantly interfere with the ability of the
      system to perform other database operations. Cost-based vacuum
      delay provides a way for administrators to achieve this.
     </p><p>
      This feature is disabled by default for manually issued
      <code class="command">VACUUM</code> commands. To enable it, set the
      <code class="varname">vacuum_cost_delay</code> variable to a nonzero
      value.
     </p><div class="variablelist"><dl class="variablelist"><dt id="GUC-VACUUM-COST-DELAY"><span class="term"><code class="varname">vacuum_cost_delay</code> (<code class="type">floating point</code>)
       <a id="id-1.6.6.13.5.5.1.1.3" class="indexterm"></a>
       </span> <a href="#GUC-VACUUM-COST-DELAY" class="id_link">#</a></dt><dd><p>
         The amount of time that the process will sleep when the cost
         limit has been exceeded. If this value is specified without
         units, it is taken as milliseconds. The default value is
         <code class="literal">0</code>, which disables the cost-based vacuum delay
         feature.  Positive values enable cost-based vacuuming.
        </p><p>
         When using cost-based vacuuming, appropriate values for
         <code class="varname">vacuum_cost_delay</code> are usually quite small, perhaps
         less than 1 millisecond.  While <code class="varname">vacuum_cost_delay</code>
         can be set to fractional-millisecond values, such delays may not be
         measured accurately on older platforms.  On such platforms,
         increasing <code class="command">VACUUM</code>'s throttled resource consumption
         above what you get at 1ms will require changing the other vacuum cost
         parameters.  You should, nonetheless,
         keep <code class="varname">vacuum_cost_delay</code> as small as your platform
         will consistently measure; large delays are not helpful.
        </p></dd><dt id="GUC-VACUUM-COST-PAGE-HIT"><span class="term"><code class="varname">vacuum_cost_page_hit</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.5.5.2.1.3" class="indexterm"></a>
       </span> <a href="#GUC-VACUUM-COST-PAGE-HIT" class="id_link">#</a></dt><dd><p>
         The estimated cost for vacuuming a buffer found in the shared
         buffer cache. It represents the cost to lock the buffer pool,
         lookup the shared hash table and scan the content of the page.
         The default value is <code class="literal">1</code>.
        </p></dd><dt id="GUC-VACUUM-COST-PAGE-MISS"><span class="term"><code class="varname">vacuum_cost_page_miss</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.5.5.3.1.3" class="indexterm"></a>
       </span> <a href="#GUC-VACUUM-COST-PAGE-MISS" class="id_link">#</a></dt><dd><p>
         The estimated cost for vacuuming a buffer that has to be read from
         disk.  This represents the effort to lock the buffer pool,
         lookup the shared hash table, read the desired block in from
         the disk and scan its content. The default value is
         <code class="literal">2</code>.
        </p></dd><dt id="GUC-VACUUM-COST-PAGE-DIRTY"><span class="term"><code class="varname">vacuum_cost_page_dirty</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.5.5.4.1.3" class="indexterm"></a>
       </span> <a href="#GUC-VACUUM-COST-PAGE-DIRTY" class="id_link">#</a></dt><dd><p>
         The estimated cost charged when vacuum modifies a block that was
         previously clean. It represents the extra I/O required to
         flush the dirty block out to disk again. The default value is
         <code class="literal">20</code>.
        </p></dd><dt id="GUC-VACUUM-COST-LIMIT"><span class="term"><code class="varname">vacuum_cost_limit</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.5.5.5.1.3" class="indexterm"></a>
       </span> <a href="#GUC-VACUUM-COST-LIMIT" class="id_link">#</a></dt><dd><p>
         This is the accumulated cost that will cause the vacuuming
         process to sleep for <code class="varname">vacuum_cost_delay</code>.  The
         default is <code class="literal">200</code>.
        </p></dd></dl></div><div class="note"><h3 class="title">Note</h3><p>
       There are certain operations that hold critical locks and should
       therefore complete as quickly as possible.  Cost-based vacuum
       delays do not occur during such operations.  Therefore it is
       possible that the cost accumulates far higher than the specified
       limit.  To avoid uselessly long delays in such cases, the actual
       delay is calculated as <code class="varname">vacuum_cost_delay</code> *
       <code class="varname">accumulated_balance</code> /
       <code class="varname">vacuum_cost_limit</code> with a maximum of
       <code class="varname">vacuum_cost_delay</code> * 4.
      </p></div></div><div class="sect2" id="RUNTIME-CONFIG-VACUUM-DEFAULT"><div class="titlepage"><div><div><h3 class="title">19.10.3. Default Behavior <a href="#RUNTIME-CONFIG-VACUUM-DEFAULT" class="id_link">#</a></h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="GUC-VACUUM-TRUNCATE"><span class="term"><code class="varname">vacuum_truncate</code> (<code class="type">boolean</code>)
       <a id="id-1.6.6.13.6.2.1.1.3" class="indexterm"></a>
       </span> <a href="#GUC-VACUUM-TRUNCATE" class="id_link">#</a></dt><dd><p>
         Enables or disables vacuum to try to truncate off any empty pages at
         the end of the table.  The default value is <code class="literal">true</code>.
         If <code class="literal">true</code>, <code class="command">VACUUM</code> and autovacuum
         do the truncation and the disk space for the truncated pages is
         returned to the operating system.  Note that the truncation requires
         an <code class="literal">ACCESS EXCLUSIVE</code> lock on the table.  The
         <code class="literal">TRUNCATE</code> parameter of
         <a class="link" href="sql-vacuum.html" title="VACUUM"><code class="command">VACUUM</code></a>, if
         specified, overrides the value of this parameter.  The setting can
         also be overridden for individual tables by changing table storage
         parameters.
        </p></dd></dl></div></div><div class="sect2" id="RUNTIME-CONFIG-VACUUM-FREEZING"><div class="titlepage"><div><div><h3 class="title">19.10.4. Freezing <a href="#RUNTIME-CONFIG-VACUUM-FREEZING" class="id_link">#</a></h3></div></div></div><p>
      To maintain correctness even after transaction IDs wrap around,
      <span class="productname">PostgreSQL</span> marks rows that are sufficiently
      old as <span class="emphasis"><em>frozen</em></span>. These rows are visible to everyone;
      other transactions do not need to examine their inserting XID to
      determine visibility. <code class="command">VACUUM</code> is responsible for
      marking rows as frozen. The following settings control
      <code class="command">VACUUM</code>'s freezing behavior and should be tuned based
      on the XID consumption rate of the system and data access patterns of the
      dominant workloads. See <a class="xref" href="routine-vacuuming.html#VACUUM-FOR-WRAPAROUND" title="24.1.5. Preventing Transaction ID Wraparound Failures">Section 24.1.5</a> for more
      information on transaction ID wraparound and tuning these parameters.
     </p><div class="variablelist"><dl class="variablelist"><dt id="GUC-VACUUM-FREEZE-TABLE-AGE"><span class="term"><code class="varname">vacuum_freeze_table_age</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.7.3.1.1.3" class="indexterm"></a>
       </span> <a href="#GUC-VACUUM-FREEZE-TABLE-AGE" class="id_link">#</a></dt><dd><p>
         <code class="command">VACUUM</code> performs an aggressive scan if the table's
         <code class="structname">pg_class</code>.<code class="structfield">relfrozenxid</code> field has reached
         the age specified by this setting.  An aggressive scan differs from
         a regular <code class="command">VACUUM</code> in that it visits every page that might
         contain unfrozen XIDs or MXIDs, not just those that might contain dead
         tuples.  The default is 150 million transactions.  Although users can
         set this value anywhere from zero to two billion, <code class="command">VACUUM</code>
         will silently limit the effective value to 95% of
         <a class="xref" href="runtime-config-vacuum.html#GUC-AUTOVACUUM-FREEZE-MAX-AGE">autovacuum_freeze_max_age</a>, so that a
         periodic manual <code class="command">VACUUM</code> has a chance to run before an
         anti-wraparound autovacuum is launched for the table. For more
         information see
         <a class="xref" href="routine-vacuuming.html#VACUUM-FOR-WRAPAROUND" title="24.1.5. Preventing Transaction ID Wraparound Failures">Section 24.1.5</a>.
        </p></dd><dt id="GUC-VACUUM-FREEZE-MIN-AGE"><span class="term"><code class="varname">vacuum_freeze_min_age</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.7.3.2.1.3" class="indexterm"></a>
       </span> <a href="#GUC-VACUUM-FREEZE-MIN-AGE" class="id_link">#</a></dt><dd><p>
         Specifies the cutoff age (in transactions) that
         <code class="command">VACUUM</code> should use to decide whether to
         trigger freezing of pages that have an older XID.
         The default is 50 million transactions.  Although
         users can set this value anywhere from zero to one billion,
         <code class="command">VACUUM</code> will silently limit the effective value to half
         the value of <a class="xref" href="runtime-config-vacuum.html#GUC-AUTOVACUUM-FREEZE-MAX-AGE">autovacuum_freeze_max_age</a>, so
         that there is not an unreasonably short time between forced
         autovacuums.  For more information see <a class="xref" href="routine-vacuuming.html#VACUUM-FOR-WRAPAROUND" title="24.1.5. Preventing Transaction ID Wraparound Failures">Section 24.1.5</a>.
        </p></dd><dt id="GUC-VACUUM-FAILSAFE-AGE"><span class="term"><code class="varname">vacuum_failsafe_age</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.7.3.3.1.3" class="indexterm"></a>
       </span> <a href="#GUC-VACUUM-FAILSAFE-AGE" class="id_link">#</a></dt><dd><p>
         Specifies the maximum age (in transactions) that a table's
         <code class="structname">pg_class</code>.<code class="structfield">relfrozenxid</code>
         field can attain before <code class="command">VACUUM</code> takes
         extraordinary measures to avoid system-wide transaction ID
         wraparound failure.  This is <code class="command">VACUUM</code>'s
         strategy of last resort.  The failsafe typically triggers
         when an autovacuum to prevent transaction ID wraparound has
         already been running for some time, though it's possible for
         the failsafe to trigger during any <code class="command">VACUUM</code>.
        </p><p>
         When the failsafe is triggered, any cost-based delay that is
         in effect will no longer be applied, further non-essential
         maintenance tasks (such as index vacuuming) are bypassed, and any
         <a class="glossterm" href="glossary.html#GLOSSARY-BUFFER-ACCESS-STRATEGY"><em class="glossterm"><a class="glossterm" href="glossary.html#GLOSSARY-BUFFER-ACCESS-STRATEGY" title="Buffer Access Strategy">Buffer Access Strategy</a></em></a>
         in use will be disabled resulting in <code class="command">VACUUM</code> being
         free to make use of all of
         <a class="glossterm" href="glossary.html#GLOSSARY-SHARED-MEMORY"><em class="glossterm"><a class="glossterm" href="glossary.html#GLOSSARY-SHARED-MEMORY" title="Shared memory">shared buffers</a></em></a>.
        </p><p>
         The default is 1.6 billion transactions.  Although users can
         set this value anywhere from zero to 2.1 billion,
         <code class="command">VACUUM</code> will silently adjust the effective
         value to no less than 105% of <a class="xref" href="runtime-config-vacuum.html#GUC-AUTOVACUUM-FREEZE-MAX-AGE">autovacuum_freeze_max_age</a>.
        </p></dd><dt id="GUC-VACUUM-MULTIXACT-FREEZE-TABLE-AGE"><span class="term"><code class="varname">vacuum_multixact_freeze_table_age</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.7.3.4.1.3" class="indexterm"></a>
       </span> <a href="#GUC-VACUUM-MULTIXACT-FREEZE-TABLE-AGE" class="id_link">#</a></dt><dd><p>
         <code class="command">VACUUM</code> performs an aggressive scan if the table's
         <code class="structname">pg_class</code>.<code class="structfield">relminmxid</code> field has reached
         the age specified by this setting.  An aggressive scan differs from
         a regular <code class="command">VACUUM</code> in that it visits every page that might
         contain unfrozen XIDs or MXIDs, not just those that might contain dead
         tuples.  The default is 150 million multixacts.
         Although users can set this value anywhere from zero to two billion,
         <code class="command">VACUUM</code> will silently limit the effective value to 95% of
         <a class="xref" href="runtime-config-vacuum.html#GUC-AUTOVACUUM-MULTIXACT-FREEZE-MAX-AGE">autovacuum_multixact_freeze_max_age</a>, so that a
         periodic manual <code class="command">VACUUM</code> has a chance to run before an
         anti-wraparound is launched for the table.
         For more information see <a class="xref" href="routine-vacuuming.html#VACUUM-FOR-MULTIXACT-WRAPAROUND" title="24.1.5.1. Multixacts and Wraparound">Section 24.1.5.1</a>.
        </p></dd><dt id="GUC-VACUUM-MULTIXACT-FREEZE-MIN-AGE"><span class="term"><code class="varname">vacuum_multixact_freeze_min_age</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.7.3.5.1.3" class="indexterm"></a>
       </span> <a href="#GUC-VACUUM-MULTIXACT-FREEZE-MIN-AGE" class="id_link">#</a></dt><dd><p>
         Specifies the cutoff age (in multixacts) that <code class="command">VACUUM</code>
         should use to decide whether to trigger freezing of pages with
         an older multixact ID.  The default is 5 million multixacts.
         Although users can set this value anywhere from zero to one billion,
         <code class="command">VACUUM</code> will silently limit the effective value to half
         the value of <a class="xref" href="runtime-config-vacuum.html#GUC-AUTOVACUUM-MULTIXACT-FREEZE-MAX-AGE">autovacuum_multixact_freeze_max_age</a>,
         so that there is not an unreasonably short time between forced
         autovacuums.
         For more information see <a class="xref" href="routine-vacuuming.html#VACUUM-FOR-MULTIXACT-WRAPAROUND" title="24.1.5.1. Multixacts and Wraparound">Section 24.1.5.1</a>.
        </p></dd><dt id="GUC-VACUUM-MULTIXACT-FAILSAFE-AGE"><span class="term"><code class="varname">vacuum_multixact_failsafe_age</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.13.7.3.6.1.3" class="indexterm"></a>
       </span> <a href="#GUC-VACUUM-MULTIXACT-FAILSAFE-AGE" class="id_link">#</a></dt><dd><p>
         Specifies the maximum age (in multixacts) that a table's
         <code class="structname">pg_class</code>.<code class="structfield">relminmxid</code>
         field can attain before <code class="command">VACUUM</code> takes
         extraordinary measures to avoid system-wide multixact ID
         wraparound failure.  This is <code class="command">VACUUM</code>'s
         strategy of last resort.  The failsafe typically triggers when
         an autovacuum to prevent transaction ID wraparound has already
         been running for some time, though it's possible for the
         failsafe to trigger during any <code class="command">VACUUM</code>.
        </p><p>
         When the failsafe is triggered, any cost-based delay that is
         in effect will no longer be applied, and further non-essential
         maintenance tasks (such as index vacuuming) are bypassed.
        </p><p>
         The default is 1.6 billion multixacts.  Although users can set
         this value anywhere from zero to 2.1 billion,
         <code class="command">VACUUM</code> will silently adjust the effective
         value to no less than 105% of <a class="xref" href="runtime-config-vacuum.html#GUC-AUTOVACUUM-MULTIXACT-FREEZE-MAX-AGE">autovacuum_multixact_freeze_max_age</a>.
        </p></dd><dt id="GUC-VACUUM-MAX-EAGER-FREEZE-FAILURE-RATE"><span class="term"><code class="varname">vacuum_max_eager_freeze_failure_rate</code> (<code class="type">floating point</code>)
      <a id="id-1.6.6.13.7.3.7.1.3" class="indexterm"></a>
      </span> <a href="#GUC-VACUUM-MAX-EAGER-FREEZE-FAILURE-RATE" class="id_link">#</a></dt><dd><p>
        Specifies the maximum number of pages (as a fraction of total pages in
        the relation) that <code class="command">VACUUM</code> may scan and
        <span class="emphasis"><em>fail</em></span> to set all-frozen in the visibility map
        before disabling eager scanning. A value of <code class="literal">0</code>
        disables eager scanning altogether. The default is
        <code class="literal">0.03</code> (3%).
       </p><p>
        Note that when eager scanning is enabled, only freeze failures
        count against the cap, not successful freezing. Successful page
        freezes are capped internally at 20% of the all-visible but not
        all-frozen pages in the relation. Capping successful page freezes helps
        amortize the overhead across multiple normal vacuums and limits the
        potential downside of wasted eager freezes of pages that are modified
        again before the next aggressive vacuum.
       </p><p>
        This parameter can only be set in the
        <code class="filename">postgresql.conf</code> file or on the server command
        line; but the setting can be overridden for individual tables by
        changing the
        <a class="link" href="sql-createtable.html#RELOPTION-VACUUM-MAX-EAGER-FREEZE-FAILURE-RATE">
        corresponding table storage parameter</a>.
        For more information on tuning vacuum's freezing behavior,
        see <a class="xref" href="routine-vacuuming.html#VACUUM-FOR-WRAPAROUND" title="24.1.5. Preventing Transaction ID Wraparound Failures">Section 24.1.5</a>.
       </p></dd></dl></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="runtime-config-statistics.html" title="19.9. Run-time Statistics">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime-config.html" title="Chapter 19. Server Configuration">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="runtime-config-client.html" title="19.11. Client Connection Defaults">Next</a></td></tr><tr><td width="40%" align="left" valign="top">19.9. Run-time Statistics </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 18.0 Documentation">Home</a></td><td width="40%" align="right" valign="top"> 19.11. Client Connection Defaults</td></tr></table></div></body></html>